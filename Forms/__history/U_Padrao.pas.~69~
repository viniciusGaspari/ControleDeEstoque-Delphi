unit U_Padrao;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.Buttons, Vcl.DBCtrls,
  Vcl.StdCtrls, Data.DB, Data.Win.ADODB;

type
  TFrm_padrao = class(TForm)
    Panel1: TPanel;
    Panel2: TPanel;
    bt_novo: TBitBtn;
    bt_Deletar: TBitBtn;
    bt_Editar: TBitBtn;
    bt_Gravar: TBitBtn;
    bt_Cancelar: TBitBtn;
    bt_Atualizar: TBitBtn;
    DBNavigator1: TDBNavigator;
    bt_Pesquisar: TBitBtn;
    Q_padrao: TADOQuery;
    ds_padrao: TDataSource;
    bt_Sair: TBitBtn;
    procedure FormKeyPress(Sender: TObject; var Key: Char);
    procedure bt_novoClick(Sender: TObject);
    procedure bt_DeletarClick(Sender: TObject);
    procedure bt_EditarClick(Sender: TObject);
    procedure bt_GravarClick(Sender: TObject);
    procedure bt_CancelarClick(Sender: TObject);
    procedure bt_AtualizarClick(Sender: TObject);
    procedure bt_SairClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    procedure TrataBotoes(flag, flag1, flag2, flag3, flag4, flag5, flag6: boolean);
    procedure AplicarPadraoLabels;
    procedure AplicarMaiusculo;
    procedure AplicarMaiusculoDBEdit;
    procedure DBEditMaiusculo(Sender: TObject; var Key: Char);
  public
  end;

var
  Frm_padrao: TFrm_padrao;

implementation

{$R *.dfm}

procedure TFrm_padrao.AplicarMaiusculo;
begin
  // Chama a rotina que aplica maiúsculo em todos os DBEdits
  AplicarMaiusculoDBEdit;
end;

procedure TFrm_padrao.AplicarMaiusculoDBEdit;
var
  i: Integer;
begin
  for i := 0 to ComponentCount - 1 do
    if Components[i] is TDBEdit then
      TDBEdit(Components[i]).OnKeyPress := DBEditMaiusculo;
end;

procedure TFrm_padrao.DBEditMaiusculo(Sender: TObject; var Key: Char);
begin
  Key := UpCase(Key); // converte cada caractere digitado para maiúsculo
end;

procedure TFrm_padrao.AplicarPadraoLabels;
var
  i: Integer;
begin
  for i := 0 to ComponentCount - 1 do
    if Components[i] is TLabel then
      with TLabel(Components[i]) do
      begin
        Font.Name  := 'Segoe UI';
        Font.Size  := 10;
        Font.Style := [fsBold];
        Font.Color := clNavy;
      end;
end;

procedure TFrm_padrao.bt_AtualizarClick(Sender: TObject);
begin
  Q_padrao.Refresh;
  MessageDlg('Registro atualizado com sucesso', mtInformation,[mbOk],0);
end;

procedure TFrm_padrao.bt_CancelarClick(Sender: TObject);
begin
  TrataBotoes(true, true, true, true, true, true, true);
  Q_padrao.Cancel;
  MessageDlg('Ação cancelada pelo usuário', mtInformation,[mbOk],0);
  bt_cancelar.Enabled := false;
  bt_gravar.Enabled := false;
end;

procedure TFrm_padrao.bt_DeletarClick(Sender: TObject);
begin
  if MessageDlg('Deseja deletar esse registro?', mtConfirmation, [mbOk, mbNo],0) = mrOk then
  begin
    Q_padrao.Delete;
    MessageDlg('Registro deletado com sucesso', mtInformation,[mbOk],0);
  end
  else
    Abort;
end;

procedure TFrm_padrao.bt_EditarClick(Sender: TObject);
begin
  TrataBotoes(false, false, false, true, false, false, true);
  if MessageDlg('Deseja editar esse registro?', mtConfirmation, [mbOk, mbNo],0) = mrOk then
    Q_padrao.Edit
  else
    Abort;
end;

procedure TFrm_padrao.bt_GravarClick(Sender: TObject);
begin
  TrataBotoes(true, true, true, true, true, true, true);
  Q_padrao.Post;
  MessageDlg('Registro salvo com sucesso!', mtInformation,[mbOk],0);
  bt_gravar.Enabled := false;
  bt_cancelar.Enabled := false;
end;

procedure TFrm_padrao.bt_novoClick(Sender: TObject);
begin
  TrataBotoes(false, false, false, true, false, false, true);
  Q_padrao.Open;
  Q_padrao.Append;
end;

procedure TFrm_padrao.bt_SairClick(Sender: TObject);
begin
  Close;
end;

procedure TFrm_padrao.FormKeyPress(Sender: TObject; var Key: Char);
begin
  if Key = #13 then
  begin
    Key := #0;
    Perform(WM_NEXTDLGCTL, 0, 0); // corrigido
  end;
end;

procedure TFrm_padrao.FormShow(Sender: TObject);
begin
  AplicarPadraoLabels;
  AplicarMaiusculo; // agora aplica maiúsculo em todos os DBEdits
end;

procedure TFrm_padrao.TrataBotoes(flag, flag1, flag2, flag3, flag4, flag5, flag6: boolean);
begin
  bt_Novo.Enabled := flag;
  bt_Deletar.Enabled := flag1;
  bt_Editar.Enabled := flag2;
  bt_Gravar.Enabled := flag3;
  bt_Atualizar.Enabled := flag4;
  bt_Pesquisar.Enabled := flag5;
  bt_Cancelar.Enabled := flag6;
end;

end.

